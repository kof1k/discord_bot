# üì¶ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è VPS –∑ –æ–±–º–µ–∂–µ–Ω–∏–º –¥–∏—Å–∫–æ–º (40GB)

## –í–∞—à–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —ñ–¥–µ–∞–ª—å–Ω–∞, –ö–†–Ü–ú –¥–∏—Å–∫—É!

‚úÖ **2 vCPU** - –≤—ñ–¥–º—ñ–Ω–Ω–æ!
‚úÖ **4 GB RAM** - —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å!
‚úÖ **20 TB —Ç—Ä–∞—Ñ—ñ–∫** - –±—ñ–ª—å—à –Ω—ñ–∂ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ
‚ö†Ô∏è **40 GB –¥–∏—Å–∫** - –ø–æ—Ç—Ä—ñ–±–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è

## üéØ –©–æ –º–æ–∂–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –Ω–∞ 40GB:

```
–°–∏—Å—Ç–µ–º–∞ Ubuntu:           ~5 GB
Node.js + –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:     ~2 GB
PostgreSQL + –ë–î:          ~1 GB
–õ–æ–≥–∏, –±–µ–∫–∞–ø–∏:             ~2 GB
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –º—É–∑–∏–∫–∏:      ~30 GB

30 GB = ~3000-6000 —Ç—Ä–µ–∫—ñ–≤
```

## ‚öôÔ∏è –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –¥–ª—è 40GB

### 1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é

–°–∫–æ–ø—ñ—é–π—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:

```bash
cp .env.small-disk .env
```

–ê–±–æ –¥–æ–¥–∞–π—Ç–µ –≤ `.env`:

```env
# –ê–≥—Ä–µ—Å–∏–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è
CLEANUP_DAYS=3                    # –í–∏–¥–∞–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 3 –¥–Ω—ñ –∑–∞–º—ñ—Å—Ç—å 7
MAX_STORAGE_GB=25                 # –õ—ñ–º—ñ—Ç 25GB (–∑–∞–ª–∏—à–∏—Ç–∏ –∑–∞–ø–∞—Å)
CLEANUP_ENABLED=true
CLEANUP_SCHEDULE=0 */6 * * *      # –ö–æ–∂–Ω—ñ 6 –≥–æ–¥–∏–Ω –∑–∞–º—ñ—Å—Ç—å 1 —Ä–∞–∑ –Ω–∞ –¥–µ–Ω—å
```

### 2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –¥–∏—Å–∫—É

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
node scripts/monitor-disk.js

# –î–æ–¥–∞—Ç–∏ –≤ crontab (–∫–æ–∂–Ω—ñ 2 –≥–æ–¥–∏–Ω–∏)
crontab -e
```

–î–æ–¥–∞—Ç–∏:
```cron
0 */2 * * * cd /home/discord_bot && node scripts/monitor-disk.js >> /var/music_bot/logs/disk-monitor.log 2>&1
```

### 3. –î–æ–¥–∞–π—Ç–µ npm —Å–∫—Ä–∏–ø—Ç

–í `package.json` –≤–∂–µ —î:
```bash
npm run health     # –ü–æ–∫–∞–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–∏—Å–∫—É
```

–ê–±–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—Ä—É—á–Ω—É:
```bash
du -sh /var/music_bot/music
df -h
```

## üßπ –°—Ç—Ä–∞—Ç–µ–≥—ñ—ó –µ–∫–æ–Ω–æ–º—ñ—ó –º—ñ—Å—Ü—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è

–ë–æ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –≤–∏–¥–∞–ª—è—Ç–∏–º–µ —Ç—Ä–µ–∫–∏ —è–∫—ñ:
- –ù–µ —Å–ª—É—Ö–∞–ª–∏—Å—å 3 –¥–Ω—ñ (–∑–∞–º—ñ—Å—Ç—å 7)
- –ù–µ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–∞—Ö
- –ù–µ –≤ —É–ª—é–±–ª–µ–Ω–æ–º—É

### –†—É—á–Ω–∞ –æ—á–∏—Å—Ç–∫–∞

```bash
# –û—á–∏—Å—Ç–∏—Ç–∏ –∑–∞—Ä–∞–∑
npm run cleanup

# –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ —Å—Ç–∞—Ä—ñ —Ç—Ä–µ–∫–∏
node scripts/cleanup-tracks.js

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–∫—ñ–ª—å–∫–∏ —Ç—Ä–µ–∫—ñ–≤ –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏
psql -U music_bot_user -d music_bot -c "
  SELECT COUNT(*), SUM(file_size)/1024/1024/1024 as size_gb
  FROM tracks
  WHERE last_played < NOW() - INTERVAL '3 days'
  AND is_deleted = FALSE
"
```

### –û–±–º–µ–∂–µ–Ω–Ω—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

–ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –≤ –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å –æ–±–º–µ–∂–µ–Ω–Ω—è:
- –ú–∞–∫—Å–∏–º—É–º —Ç—Ä–µ–∫—ñ–≤ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –ê–≤—Ç–æ–≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–∞–π–º–µ–Ω—à –ø–æ–ø—É–ª—è—Ä–Ω–∏—Ö

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è

–ö–æ–ª–∏ –¥–∏—Å–∫ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π >85%, –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
1. –ù–∞–¥—ñ—à–ª–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—É –≤ Telegram
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—â–µ–Ω–Ω—è
3. –í–∏–¥–∞–ª–∏—Ç—å –Ω–∞–π—Å—Ç–∞—Ä—ñ—à—ñ —Ç—Ä–µ–∫–∏

### –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

```bash
# –ó–∞–≥–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ç—É—Å
npm run health

# –¢—ñ–ª—å–∫–∏ –¥–∏—Å–∫
node scripts/monitor-disk.js

# –†–æ–∑–º—ñ—Ä –º—É–∑–∏—á–Ω–æ—ó –ø–∞–ø–∫–∏
du -sh /var/music_bot/music

# –¢–æ–ø –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤
du -h /var/music_bot/music/* | sort -rh | head -20
```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### –ö–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è (–∑–∞—Ä–∞–∑)

1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∞–≥—Ä–µ—Å–∏–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è
2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
3. –û–±–º–µ–∂—Ç–µ –¥–æ ~3000 —Ç—Ä–µ–∫—ñ–≤

```bash
# –ù–∞–ª–∞—à—Ç—É–π—Ç–µ
cp .env.small-disk .env
nano .env  # –î–æ–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω–∏

# –ó–∞–ø—É—Å—Ç—ñ—Ç—å
npm run pm2:start

# –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
npm run health
```

### –î–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

**–ê–ø–≥—Ä–µ–π–¥ –¥–∏—Å–∫—É –¥–æ 180-200 GB**

–ó–∞–∑–≤–∏—á–∞–π –∫–æ—à—Ç—É—î +$2-5/–º—ñ—Å—è—Ü—å:
- –£ –±—ñ–ª—å—à–æ—Å—Ç—ñ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤ –º–æ–∂–Ω–∞ –∞–ø–≥—Ä–µ–π–¥–∏—Ç–∏ –±–µ–∑ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∏
- –ü—Ä–æ—Å—Ç–æ –∑–±—ñ–ª—å—à–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –¥–∏—Å–∫—É –≤ –ø–∞–Ω–µ–ª—ñ
- –†–æ–∑—à–∏—Ä–∏—Ç–∏ –ø–∞—Ä—Ç–∏—Ü—ñ—é

```bash
# –ü—ñ—Å–ª—è –∞–ø–≥—Ä–µ–π–¥—É –¥–∏—Å–∫—É:
# –†–æ–∑—à–∏—Ä–∏—Ç–∏ –ø–∞—Ä—Ç–∏—Ü—ñ—é (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
sudo resize2fs /dev/vda1

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏
df -h
```

## üéØ –û–ø—Ç–∏–º–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è 40GB

### .env —Ñ–∞–π–ª:

```env
# –î–∏—Å–∫
MUSIC_DIR=/var/music_bot/music
MAX_STORAGE_GB=25
CLEANUP_DAYS=3
CLEANUP_ENABLED=true
CLEANUP_SCHEDULE=0 */6 * * *

# –ë–î - –æ–±–ª–µ–≥—à–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è
DB_POOL_MAX=10              # –ó–∞–º—ñ—Å—Ç—å 20
```

### Crontab:

```cron
# –û—á–∏—â–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 6 –≥–æ–¥–∏–Ω
0 */6 * * * /home/discord_bot/scripts/cleanup-tracks.js

# –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∫–æ–∂–Ω—ñ 2 –≥–æ–¥–∏–Ω–∏
0 */2 * * * node /home/discord_bot/scripts/monitor-disk.js

# –ë–µ–∫–∞–ø —Ç—ñ–ª—å–∫–∏ –ë–î (–±–µ–∑ –º—É–∑–∏–∫–∏)
0 2 * * * pg_dump -U music_bot_user music_bot | gzip > /var/backups/db_$(date +\%Y\%m\%d).sql.gz
```

## üìà –û—á—ñ–∫—É–≤–∞–Ω–∞ —î–º–Ω—ñ—Å—Ç—å

–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ:

| –°—Ü–µ–Ω–∞—Ä—ñ–π | –¢—Ä–µ–∫—ñ–≤ | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ |
|----------|--------|--------------|
| –õ–µ–≥–∫–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è | ~5000 | 5-10 |
| –°–µ—Ä–µ–¥–Ω—î | ~3000 | 10-20 |
| –Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω–µ | ~2000 | 20+ |

## ‚ö†Ô∏è –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω –∞–ø–≥—Ä–µ–π–¥

–ê–ø–≥—Ä–µ–π–¥—å—Ç–µ –¥–∏—Å–∫ —è–∫—â–æ:
- –ß–∞—Å—Ç—ñ—à–µ –Ω—ñ–∂ —Ä–∞–∑ –Ω–∞ –¥–µ–Ω—å –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è >85%
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Å–∫–∞—Ä–∂–∞—Ç—å—Å—è —â–æ —Ç—Ä–µ–∫–∏ –∑–Ω–∏–∫–∞—é—Ç—å
- –ü–æ—Ç—Ä—ñ–±–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ >5000 —Ç—Ä–µ–∫—ñ–≤
- –ü–ª–∞–Ω—É—î—Ç–µ –ø—É–±–ª—ñ—á–Ω–∏–π –±–æ—Ç –Ω–∞ –±–∞–≥–∞—Ç–æ —Å–µ—Ä–≤–µ—Ä—ñ–≤

## üí∞ –í–∞—Ä—ñ–∞–Ω—Ç–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤ –∑ –±—ñ–ª—å—à–∏–º –¥–∏—Å–∫–æ–º

**~$5-7/–º—ñ—Å—è—Ü—å:**
- Hetzner CX21: 4GB RAM, **80 GB SSD**
- Contabo VPS S: 4GB RAM, **100 GB SSD**
- OVH VPS Value: 4GB RAM, **80 GB SSD**

**~$10/–º—ñ—Å—è—Ü—å:**
- DigitalOcean: 4GB RAM, **160 GB SSD**
- Vultr: 4GB RAM, **160 GB SSD**

## ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫

**–í–∞—à VPS —Ü—ñ–ª–∫–æ–º –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è:**
- ‚úÖ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- ‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è (5-10 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)
- ‚úÖ –ù–µ–≤–µ–ª–∏–∫–∏—Ö Discord —Å–µ—Ä–≤–µ—Ä—ñ–≤

**–ù–ï –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è:**
- ‚ùå –ü—É–±–ª—ñ—á–Ω–æ–≥–æ –±–æ—Ç–∞ –Ω–∞ –±–∞–≥–∞—Ç–æ —Å–µ—Ä–≤–µ—Ä—ñ–≤
- ‚ùå –î–æ–≤–≥–æ—Ç—Ä–∏–≤–∞–ª–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –≤–µ–ª–∏–∫–æ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó
- ‚ùå –Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–µ–∑ –æ—á–∏—â–µ–Ω–Ω—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:**
–ü–æ—á–Ω—ñ—Ç—å –∑ 40GB + –∞–≥—Ä–µ—Å–∏–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è, —è–∫—â–æ —Ç—Ä–µ–±–∞ - –∞–ø–≥—Ä–µ–π–¥—å—Ç–µ –¥–æ 180-200GB –ø—ñ–∑–Ω—ñ—à–µ.

---

**–ó–∞–ø—É—Å—Ç—ñ—Ç—å —ñ —Ç–µ—Å—Ç—É–π—Ç–µ!** üöÄ

```bash
sudo ./setup-vps.sh
cp .env.small-disk .env
nano .env  # –î–æ–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω–∏
npm install
npm run init-db
npm run pm2:start
npm run health
```
